---
postgres_manifests_dir: /etc/k8s/manifests/postgres

postgres:
  name: postgres
  replicas: 1
  type: NodePort

postgres_labels:
  k8s-app: postgres
  version: v1
  kubernetes.io/cluster-service: "true"

postgres_volumes:
    - name: varlibpostgres
      hostPath: 
        path: /var/lib/postgres/data
    - name: postgres-config
      secret:
        secretName: "postgres-config"

postgres_selector:
  k8s-app: postgres

postgres_container_image:
  name: quay.io/arkena/k8s-postgres
  tag: latest

postgres_container_env:
  - name: "POSTGRES_PASSWORD"
    value: "{{ pg_pass }}"

postgres_container_ports:
  - containerPort: 5432

postgres_container_volumemounts:
  - name: varlibpostgres
    mountPath: /var/lib/postgresql/data
  - name: postgres-config
    mountPath: "/etc/secrets"
    readOnly: true

# Container limits
postgres_container_limits:
  cpu: 800m
  memory: 1Gi

postgres_secrets:
  name: "postgres-config"
  type: "Opaque"
  data:
    password: "{{ pg_pass | b64encode }}"
    postgresql.conf: "{{ lookup('file',role_path+'/files/postgresql.conf') | b64encode }}"
    pghba.conf: "{{ lookup('file',role_path+'/files/pg_hba.conf') | b64encode }}"
